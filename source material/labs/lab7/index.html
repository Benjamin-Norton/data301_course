<html>
<head>
<title>DATA 301 - Lab 7</title>
<link href="../assign.css" type=text/css rel=stylesheet>
</head>

<body>

<h1>DATA 301 - Introduction to Data Analytics
<br/>Lab 7: Python Databases and Map-Reduce</h1>

<hr>

<p>In this lab, we will use Python for data processing using SQL databases and Map-Reduce. <strong>This lab can be done in pairs. Computer Science majors cannot pair with each other. You can do it solo if you wish. Pairs are not required. If working in a pair, only submit from one person with both names on the files.</strong></p>

<p><strong>Note: If you are off campus, you MUST connect using <a href="https://it.ubc.ca/services/email-voice-internet/myvpn/setup-documents">VPN to UBC Okanagan</a> (use: myvpn.ok.ubc.ca) to be able to access the databases.</strong></p>

<h3>Objectives</h3>

<ol>
<li>Use Python to connect to a MySQL relational database and execute SQL queries.</li>
<li>Perform data analysis and linear regression on relational data.</li>
<li>Write a small Map-Reduce program for data analysis.</li>
</ol>

<h3>Question #1 - Database Querying (5 marks)</h3>

<p>Write a Python program to query a MySQL database and print the query results. Details:

<ul>
<li>Put a comment at the top of the Python file called <code>lab7q1</code> with your name and student number. (0.5 mark)</li>
<li>Make a connection to the MySQL database with this connection information: (0.5 mark)
<pre>
 cnx = mysql.connector.connect(user='rlawrenc', password='test', host='cosc304.ok.ubc.ca', database='WorksOn')
</pre>
</li>
<li>Write and execute a SQL query that returns the department number (dno), department name (dname), project number (pno), project name (pname), sum of hours worked on the project as well as the number of employees working on the project. Only include records where the budget is greater than $140,000. Order by sum of hours worked descending. (3 marks) </li>
<li>Print out your query results. Note that tabs (<code>"\t"</code>) are used to line up the data in columns nicely. (1 mark)</li>
<li>To install the MySQL driver using Anaconda, run this command: <pre>conda install -c https://conda.anaconda.org/anaconda mysql-connector-python</pre> Otherwise, <a href="http://dev.mysql.com/downloads/connector/python/">see these download/install instructions</a>.</li>
</ul>
</p>

<h4>WorksOn Relational Database Schema</h4>

<pre>
emp (eno CHAR(5), ename VARCHAR(30), bdate DATE, title CHAR(2),	salary DECIMAL(9,2), supereno CHAR(5), dno CHAR(5), PRIMARY KEY (eno))
dept (dno CHAR(5), dname VARCHAR(40), mgreno CHAR(5), PRIMARY KEY (dno))                      -- mgreno is the employee number of the manager of the department (may join with emp)
proj (pno CHAR(5), pname VARCHAR(40), budget DECIMAL(9,2), dno  CHAR(5), PRIMARY KEY (pno))   -- dno is the department that has the project (may join with dept)
workson (eno  CHAR(5), pno  CHAR(5), resp VARCHAR(20), hours SMALLINT, PRIMARY KEY (eno,pno)) -- Use eno to join with emp.  Use pno to join with proj.
</pre>

<h4>Sample Output</h4>

<pre>
pno	 pname 		 dno 	 dname 		 hours 	 numemp
P4 	 Maintenance 	 D2 	 Consulting 	 96 	 2
P3 	 Budget 	 D3 	 Accounting 	 46 	 2
P1 	 Instruments 	 D1 	 Management 	 36 	 2
</pre>

<h3>Question #2 - Analyzing Database Data (5 marks)</h3>

<p>Write a Python program to query a MySQL database to extract the age and salary of the employees with salary greater than $20,000 and less than $55,000. Print the age and salaries in descending order by salary then perform a regression to determine if there is a relationship between them. Details:

<ul>
<li>Put a comment at the top of the Python file called <code>lab7q2</code> with your name and student number. (0.5 mark)</li>
<li>Make a connection to MySQL database with this connection information: (0.5 mark)
<pre>
 cnx = mysql.connector.connect(user='rlawrenc', password='test', host='cosc304.ok.ubc.ca', database='WorksOn')
</pre>
</li>
<li>Write and execute a SQL query that returns the age and salary of employees with salary greater than $20,000 and less than $55,000 ordered by salary descending. (1 mark)</li>
<li>Note: Computing the age requires using the timestampdiff() function of MySQL like this: <code>timestampdiff(YEAR, bdate, CURDATE())</code>. (<a href="http://dev.mysql.com/doc/refman/5.7/en/date-calculations.html">Click for details</a>)</li>
<li>Create lists of the data so that you can perform linear regression. Convert the salary data using <code>float()</code>. (1 mark)</li>
<li>Perform a linear regression and output the predicted formula, y-values, prediction error, and residual error. (1 mark)</li>
<li>Show the linear regression results in a chart. (1 mark)</li>
</ul>
</p>

<h4>Sample Output</h4>

<pre>
age	 salary
51 	 50000.00
46 	 50000.00
45 	 50000.00
51 	 40000.00
40 	 40000.00
43 	 30000.00
52 	 30000.00

Formula: 11.261261261261266 * x + 40900.9009009009 = y
Predicted y-values: [41475.22522523 41418.91891892 41407.65765766 41475.22522523
 41351.35135135 41385.13513514 41486.48648649]
Prediction error: [  8524.77477477   8581.08108108   8592.34234234  -1475.22522523
  -1351.35135135 -11385.13513514 -11486.48648649]
Residual error: 9855.944380912444
</pre>
<img src="img/lab7q2.png">



<h3>Question #3 - Map-Reduce (5 marks)</h3>

<p>Create a Python program that uses Map-Reduce to analyze a data set. <strong>You must use <code>map</code>, <code>filter</code>, and <code>reduce</code> functions.</strong> Details:

<ul>
<li>Put a comment at the top of the Python file called <code>lab7q3</code> with your name and student number. (0.5 mark)</li>
<li>Use a data set that consists of the numbers from 1 to 10. (0.5 mark)</li>
<li>Apply a <code>map</code> function to the data set that will divide the value by 2 if it is even or multiply by 3 if it is odd. Print the result after the map function is applied. (2 marks)</li>
<li>Apply a <code>filter</code> function that will keep the value if it is between 5 and 20 inclusive. Print the result after the filter function is applied. (1 mark)</li>
<li>Apply a <code>reduce</code> function that will add the two values if the first value is greater than the second otherwise it will multiply them. Print the result after reduce function is applied. (1 mark)</li>
</ul>

<h4>Sample Output</h4>

<pre>
Result after map: [3, 1.0, 9, 2.0, 15, 3.0, 21, 4.0, 27, 5.0]
Result after filter: [9, 15, 5.0]
Result after reduce: 140.0
</pre>

<h3>Submission</h3>

<p>When complete, submit your code files using Connect:
<ul>
<li><code>lab7q1</code> - Python code for question 1.  May be a <code>.txt</code>, <code>.py</code>, or <code>.ipynb</code> file.</li>
<li><code>lab7q2</code> - Python code for question 2.  May be a <code>.txt</code>, <code>.py</code>, or <code>.ipynb</code> file.</li>
<li><code>lab7q3</code> - Python code for question 3.  May be a <code>.txt</code>, <code>.py</code>, or <code>.ipynb</code> file.</li>
</ul>
</p>

<hr>
<img src="../../../../images/go-upwd.gif" alt="*"  align="top" height="14" width="14">
        <a href="../index.html">Home</a>
<hr>

</body>
</html>
